'use client';

import { getUserAuthData, getUserState } from '@/entities/user';
import { useAuth } from '@/features/auth';
import { BackgroundColorSpin } from '@/shared/ui/animate-background';
import { ErrorScreen } from '@/shared/ui/errors';
import { PageLoader } from '@/widgets/page-loader';
import {
	Button,
	Table,
	TableBody,
	TableCell,
	TableColumn,
	TableHeader,
	TableRow,
} from '@nextui-org/react';
import cn from 'clsx';
import Image from 'next/image';
import { FC, memo } from 'react';
import { useSelector } from 'react-redux';
import { ProfilePageProps } from '../../../app/profile/page';
import cls from './profile-page.module.scss';

export const ProfilePage: FC<ProfilePageProps> = memo(() => {
	const { data: user, isLoading, error } = useSelector(getUserState);
	const nowDate = new Date();
	const convertedDate = new Date(user?.createdAt);
	const isUserLogged = useSelector(getUserAuthData);
	const { onUserLogout } = useAuth();

	const formattedDate = `${convertedDate.getDate()}.${
		convertedDate.getMonth() + 1
	}.${convertedDate.getFullYear()}, ${convertedDate.getHours()}:${convertedDate
		.getMinutes()
		.toString()
		.padStart(2, '0')}`;

	if (!isUserLogged && !isLoading)
		return (
			<ErrorScreen
				title='–í–æ–π–¥–∏—Ç–µ –∏–ª–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å'
				description='–í—ã –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã'
				fullHeight
			/>
		);

	if (isLoading || !user) {
		return <PageLoader />;
	}

	if (error) {
		console.log(error);
		return <ErrorScreen />;
	}

	return (
		<div className={cn(cls.wrapper, 'content')}>
			<BackgroundColorSpin className={cls.card}>
				<div className={cls.user}>
					<Image
						src={`${process.env.UPLOADS}/avatars/${user?.id}/${user?.avatar}`}
						alt='–ê–≤–∞—Ç–∞—Ä'
						width={96}
						height={96}
						className={cn(cls.avatar, 'noselect')}
					/>
					<span>
						<h6>{user.username}</h6>
						<p>{user.email}</p>
					</span>
				</div>
				<div className='flex gap-2'>
					<Button variant='bordered' fullWidth>
						–ò–∑–º–µ–Ω–∏—Ç—å –ø–æ—á—Ç—É
					</Button>
					<Button variant='bordered' fullWidth>
						–ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å
					</Button>
				</div>
				<Table
					hideHeader
					isStriped
					aria-label='Example static collection table'
				>
					<TableHeader>
						<TableColumn>–ù–∞–∑–≤–∞–Ω–∏–µ</TableColumn>
						<TableColumn>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</TableColumn>
					</TableHeader>
					<TableBody>
						<TableRow key='1'>
							<TableCell>‚ú® –î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</TableCell>
							<TableCell>{formattedDate}</TableCell>
						</TableRow>
						<TableRow key='2'>
							<TableCell>‚ù§Ô∏è –ò–∑–±—Ä–∞–Ω–Ω—ã–µ –ø–æ–¥–∞—Ä–∫–∏</TableCell>
							<TableCell>{user.favorites?.length ?? 0}</TableCell>
						</TableRow>
						<TableRow key='3'>
							<TableCell>üëÄ –ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ –ø–æ–¥–∞—Ä–∫–æ–≤</TableCell>
							<TableCell>{user.history?.length ?? 0}</TableCell>
						</TableRow>
					</TableBody>
				</Table>
				<Button variant='flat' color='danger' onClick={onUserLogout}>
					–í—ã–π—Ç–∏ —Å –∞–∫–∫–∞—É–Ω—Ç–∞
				</Button>
			</BackgroundColorSpin>
		</div>
	);
});
